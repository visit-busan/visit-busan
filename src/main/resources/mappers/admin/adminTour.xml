<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.visitbusan.repository.admin.AdminTourRepository">

    <!--검색조건에 의한 관광정보 전체 개수 불러오기-->
    <select id="getTourTotalCount"
            parameterType="com.korit.visitbusan.web.dto.admin.AdminSearchTourListDto"
            resultType="Integer">
        select
            count(*)
        from
            tour_mst tm
            left outer join tour_category tc on (tm.category_id = tc.category_id)
            left outer join user_mst um on (tm.user_id = um.user_id)
        where
        1=1
        <if test="searchValue != null and searchValue !=''">
        and (
            tm.title like concat('%', #{searchValue}, '%')
            or um.username like concat('%', #{searchValue}, '%')
            or tm.tour_id like concat('%', #{searchValue}, '%')
            )
        </if>
        <if test='categoryName != null and categoryName != ""'>
            and	tc.category_name = #{categoryName}
        </if>
    </select>

    <!--  검색 조건에 의한 관광정보 정보 불러오기  -->
    <select id="searchTour"
            parameterType="com.korit.visitbusan.web.dto.admin.AdminSearchTourReqDto"
            resultType="com.korit.visitbusan.entity.admin.AdminTourMst">
        select
            tm.tour_id as tourId,
            tc.category_name as categoryName,
            tm.title,
            tm.create_date as createDate,
            tm.update_date as updateDate,
            um.username
        from
            tour_mst tm
            left outer join tour_category tc on (tm.category_id = tc.category_id)
            left outer join user_mst um on (tm.user_id = um.user_id)
        where
            1=1
        <if test="searchValue != null and searchValue !=''">
        and (
            tm.title like concat('%', #{searchValue}, '%')
            or um.username like concat('%', #{searchValue}, '%')
            or tm.tour_id like concat('%', #{searchValue}, '%')
            )
        </if>
        <if test='categoryName != null and categoryName != ""'>
            and tc.category_name = #{categoryName}
        </if>
        order by
            tm.tour_id
        <if test = 'limit == "Y"'>
            limit #{index}, #{count}
        </if>
    </select>

    <!--  관광지 Id로 테그 정보 불러오기  -->
    <select id="findTourByTourId" resultType="com.korit.visitbusan.entity.admin.AdminTourMst">
        select
            tm.tour_id as tourId,
            tc.category_name as categoryName,
            tm.title,
            um.username,
            tm.create_date as createDate,
            tm.update_date as updateDate
        from
            tour_mst tm
            left outer join tour_category tc on (tm.category_id = tc.category_id)
            left outer join user_mst um on (tm.user_id = um.user_id)
        where
            tm.tour_id = #{tourId};
    </select>

    <!--  관광정보 삭제하기  -->
    <delete id="deleteTour">
        delete
        from
            tour_mst
        where
            tour_id = #{tourId}
    </delete>

    <!--  카테고리 일괄 정보 삭제하기  -->
    <delete id="deleteTours" parameterType="list">
        delete
        from
            tour_mst
        where
            tour_id in
        <foreach collection="list" item="tourId" open="(" close=")" separator=",">
            #{tourId}
        </foreach>
    </delete>
</mapper>